# 加密与安全

在计算机系统中，我们经常会遇到很多涉及到系统安全与数据加密的问题。

比如一个普通的http请求：假设一个用户向服务端发送请求，在请求发送的过程中，黑客可能会窃取到请求中的的内容，所以需要防窃听。在服务端收到请求处理后，返回黑客还可能会篡改请求响应的内容，因此客户端必须有能力识别出请求有没有被篡改。最后，黑客可能直接拦截我们的响应，假冒我们服务端给客户端发送其他的相应内容，客户端必须有能力识别出伪造的响应。

所以，应对潜在的安全威胁，需要做到三防：

- 防窃听
- 防篡改
- 防伪造

而计算机中的加密技术就是为了实现上述目标，现代计算机密码学理论是建立在严格的数学理论基础上的，密码学已经逐渐发展成一门科学。对于绝大多数开发者来说，设计一个安全的加密算法非常困难，验证一个加密算法是否安全更加困难，当前被认为安全的加密算法仅仅是迄今为止尚未被攻破。因此，要编写安全的计算机程序，我们要做到：

不要自己设计山寨的加密算法；
不要自己实现已有的加密算法；
不要自己修改已有的加密算法。

# 编码算法

编码算法虽然不是加密算法，但是在加解密的过程中往往会涉及到提前统一编码。并且为了避免将编码算法与加密算法混为一谈，专门在这里指出。

要学习编码算法，我们先来看一看什么是编码。

ASCII码就是一种编码，字母A的编码是十六进制的0x41，字母B是0x42，以此类推。
因为ASCII编码最多只能有128个字符，要想对更多的文字进行编码，就需要用Unicode。而中文的中使用Unicode编码就是0x4e2d。同时还有常用的UTF-8编码，使用UTF-8则需要3个字节，并且大部分UTF-8编码可以由Unicode推断出来。

| 汉字 | Unicode编码 | UTF-8编码  |
|------|-------------|------------|
| 中   | 0x4e2d      | 0xe4b8ad   |
| 文   | 0x6587      | 0xe69687   |
| 编   | 0x7f16      | 0xe7bc96   |
| 码   | 0x7801      | 0xe7a081   |

## URL编码

URL编码是浏览器发送数据给服务器时使用的编码，它通常附加在URL的参数部分，例如：

https://www.baidu.com/s?wd=%E4%B8%AD%E6%96%87

之所以需要URL编码，是因为出于兼容性考虑，很多服务器只识别ASCII字符。但如果URL中包含中文、日文这些非ASCII字符怎么办？不要紧，URL编码有一套规则：

如果字符是A~Z，a~z，0~9以及-、_、.、*，则保持不变；
如果是其他字符，先转换为UTF-8编码，然后对每个字节以%XX表示。
例如：字符`中`的UTF-8编码是0xe4b8ad，因此，它的URL编码是`%E4%B8%AD`。URL编码总是大写。

Java标准库提供了一个URLEncoder类来对任意字符串进行URL编码：
```java
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;

public class Main {
    public static void main(String[] args) {
        String encoded = URLEncoder.encode("中文!", StandardCharsets.UTF_8);
        System.out.println(encoded);
    }
}
```
上述代码的运行结果是%E4%B8%AD%E6%96%87%21，`中`的URL编码是%E4%B8%AD，`文`的URL编码是%E6%96%87，!虽然是ASCII字符，也要对其编码为%21。

但是和标准的URL编码稍有不同，URLEncoder把空格字符编码成+，而现在的URL编码标准要求空格被编码为%20。这是因为URL编码是针对于URI本身，也就是查询参数？之前的部分，而URLEncoder的作用是将请求参数按照application/x-www-form-urlencoded格式进行转换，因此URLEncoder本质上并不是进行URL编码。很多地方大家都对URLEncoder有一定的误解，因此只有当作为非URL结构部分时（post等请求，放到了body中也就是表单提交）我们才需要使用URLEncoder。
在URL编码中，URL 只能包含某些特定的字符集，比如字母（A-Z, a-z）、数字（0-9）以及少数特殊字符（如 -, _, ., ~）。其他所有字符都必须被编码，以便它们不会被错误地解释或者导致协议上的问题。例如，空格通常会被编码为 %20，而一些保留字符（如 ?, &, =, + 等）也会被编码成相应的百分号形式，以防止它们被误认为是 URL 的结构部分，导致协议解析错误。但是在post请求，参数放到body部分时使用application/x-www-form-urlencoded格式时转换为+。


如果服务器收到URL编码的字符串，就可以对其进行解码，还原成原始字符串。Java标准库的URLDecoder就可以解码：

import java.net.URLDecoder;
import java.nio.charset.StandardCharsets;

public class Main {
    public static void main(String[] args) {
        String decoded = URLDecoder.decode("%E4%B8%AD%E6%96%87%21", StandardCharsets.UTF_8);
        System.out.println(decoded);
    }
}
要特别注意：URL编码是编码算法，不是加密算法。URL编码的目的是把任意文本数据编码为%前缀表示的文本，编码后的文本仅包含A~Z，a~z，0~9，-，_，.，*和%，便于浏览器和服务器处理。

## Base64编码


# 参考链接
[廖雪峰的官方网站](https://liaoxuefeng.com/books/java/security/index.html)